<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>Galleria Immagini</title>
    <link rel="stylesheet" href="styles.css">
    <script type="importmap">
      {
          "imports": {
              "react": "https://esm.sh/react@19",
              "react-dom/client": "https://esm.sh/react-dom@19/client"
          }
      }
      </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState } from "react";
        import { createRoot } from "react-dom/client";


        function RegistrationForm() {
            const [formData, setFormData] = useState({
                username: "",
                password: "",
                email: "",
                gender: "",
                interests: [],
                country: "",
            });

            const [responseMsg, setResponseMsg] = useState("");
            const [responseColor, setResponseColor] = useState("");

            const handleChange = (e) => {
                const {name, value, type, checked} = e.target;
                if (type == "checkbox") {
                    setFormData((prev) => ({
                        ...prev,
                        [name]: checked
                        ? [...[name], value]
                        : prev[name].filter((item) => item !== value),
                    }));
                } else {
                    setFormData((prev) => ({
                        ...prev, 
                        [name]:value,
                    }));
                }
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                try {
                    const response = await fetch("https://httpbin.org/post", {
                        method: "POST",
                        headers: {"Content-type": "application/json"},
                        body: JSON.stringify(formData)
                    });

                    if (!response.ok) {
                        throw new Error("Errore nella richiesta: " + response.status);
                    }
                    
                    const result = await response.json();
                    const data = JSON.parse(result.data);

                    setResponseMsg(`Utente ${data.username} creato!`);
                    setResponseColor("green");
                }
                catch(error) {
                    setResponseMsg('Utente non creato correttamente!');
                    setResponseColor("red");
                    console.error(error);
                }
            };

            return (
                <div className="registration-container">
                    <h2>Registrazione Utente</h2>
                    <form onSubmit={handleSubmit}>
                        <label>Nome Utente:</label>
                        <input
                            type="text"
                            name="username"
                            placeholder="Inserisci il nome utente"
                            value={formData.username}
                            onChange={handleChange}
                            required
                        />

                        <label>Password:</label>
                        <input
                            type="password"
                            name="password"
                            placeholder="Inserisci la password"
                            value={formData.password}
                            onChange={handleChange}
                            required
                        />

                        <label>Email:</label>
                        <input
                            type="email"
                            name="email"
                            placeholder="Inserisci la email"
                            value={formData.email}
                            onChange={handleChange}
                            required
                        />

                        <label>Genere:</label>
                        <div className="radio-group">
                            {["male", "female", "other"].map((gender) => (
                                <label key={gender}>
                                    <input
                                        type="radio"
                                        name="gender"
                                        value={gender}
                                        checked={formData.gender === gender}
                                        onChange={handleChange}
                                        required
                                    />
                                    {gender === "male"
                                        ? "Maschio"
                                        : gender === "female"
                                            ? "Femmina"
                                            : "Altro"}
                                </label>
                            ))}
                        </div>

                        <label>Interessi:</label>
                        <div className="checkbox-group">
                            {[
                                ["sport", "Sport"],
                                ["music", "Musica"],
                                ["technology", "Tecnologia"],
                                ["travel", "Viaggi"],
                                ["culture", "Cultura"],
                            ].map(([value, label]) => (
                                <label key={value}>
                                    <input
                                        type="checkbox"
                                        name="interests"
                                        value={value}
                                        checked={formData.interests.includes(value)}
                                        onChange={handleChange}
                                    />
                                    {label}
                                </label>
                            ))}
                        </div>

                        <label>Paese:</label>
                        <select
                            name="country"
                            value={formData.country}
                            onChange={handleChange}
                            required
                        >
                            <option value="">Seleziona il tuo paese</option>
                            <option value="italy">Italia</option>
                            <option value="usa">Stati Uniti</option>
                            <option value="france">Francia</option>
                            <option value="germany">Germania</option>
                            <option value="belgium">Belgio</option>
                            <option value="other">Altro</option>
                        </select>

                        <h3 style={{ color: responseColor }}>{responseMsg}</h3>

                        <button type="submit">Registrati</button>
                    </form>
                </div>
            );
        }

        const root = createRoot(document.getElementById("root"));
        root.render(<RegistrationForm />);
    </script>
</body>

</html>